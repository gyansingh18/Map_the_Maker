// tom-select/dist/js/tom-select.complete.min.js@2.4.3 downloaded from https://ga.jspm.io/npm:tom-select@2.4.3/dist/js/tom-select.complete.min.js

var u=typeof globalThis!=="undefined"?globalThis:typeof self!=="undefined"?self:global;var p={};!function(u,h){p=h()}(0,(function(){function e(u,p){u.split(/\s+/).forEach((u=>{p(u)}))}class t{constructor(){this._events={}}on(u,p){e(u,(u=>{const h=this._events[u]||[];h.push(p),this._events[u]=h}))}off(u,p){var h=arguments.length;0!==h?e(u,(u=>{if(1===h)return void delete this._events[u];const g=this._events[u];void 0!==g&&(g.splice(g.indexOf(p),1),this._events[u]=g)})):this._events={}}trigger(u,...p){var h=this;e(u,(u=>{const g=h._events[u];void 0!==g&&g.forEach((u=>{u.apply(h,p)}))}))}}const s=u=>(u=u.filter(Boolean)).length<2?u[0]||"":1==l(u)?"["+u.join("")+"]":"(?:"+u.join("|")+")",i=u=>{if(!o(u))return u.join("");let p="",h=0;const i=()=>{h>1&&(p+="{"+h+"}")};return u.forEach(((g,oe)=>{g!==u[oe-1]?(i(),p+=g,h=1):h++})),i(),p},n=u=>{let p=Array.from(u);return s(p)},o=u=>new Set(u).size!==u.length,r=u=>(u+"").replace(/([\$\(\)\*\+\.\?\[\]\^\{\|\}\\])/gu,"\\$1"),l=u=>u.reduce(((u,p)=>Math.max(u,a(p))),0),a=u=>Array.from(u).length,c=u=>{if(1===u.length)return[[u]];let p=[];const h=u.substring(1);return c(h).forEach((function(h){let g=h.slice(0);g[0]=u.charAt(0)+g[0],p.push(g),g=h.slice(0),g.unshift(u.charAt(0)),p.push(g)})),p},p=[[0,65535]];let h,g;const oe={},re={"/":"⁄∕",0:"߀",a:"ⱥɐɑ",aa:"ꜳ",ae:"æǽǣ",ao:"ꜵ",au:"ꜷ",av:"ꜹꜻ",ay:"ꜽ",b:"ƀɓƃ",c:"ꜿƈȼↄ",d:"đɗɖᴅƌꮷԁɦ",e:"ɛǝᴇɇ",f:"ꝼƒ",g:"ǥɠꞡᵹꝿɢ",h:"ħⱨⱶɥ",i:"ɨı",j:"ɉȷ",k:"ƙⱪꝁꝃꝅꞣ",l:"łƚɫⱡꝉꝇꞁɭ",m:"ɱɯϻ",n:"ꞥƞɲꞑᴎлԉ",o:"øǿɔɵꝋꝍᴑ",oe:"œ",oi:"ƣ",oo:"ꝏ",ou:"ȣ",p:"ƥᵽꝑꝓꝕρ",q:"ꝗꝙɋ",r:"ɍɽꝛꞧꞃ",s:"ßȿꞩꞅʂ",t:"ŧƭʈⱦꞇ",th:"þ",tz:"ꜩ",u:"ʉ",v:"ʋꝟʌ",vy:"ꝡ",w:"ⱳ",y:"ƴɏỿ",z:"ƶȥɀⱬꝣ",hv:"ƕ"};for(let u in re){let p=re[u]||"";for(let h=0;h<p.length;h++){let g=p.substring(h,h+1);oe[g]=u}}const ae=new RegExp(Object.keys(oe).join("|")+"|[̀-ͯ·ʾʼ]","gu"),m=(u,p="NFKD")=>u.normalize(p),v=u=>Array.from(u).reduce(((u,p)=>u+y(p)),""),y=u=>(u=m(u).toLowerCase().replace(ae,(u=>oe[u]||"")),m(u,"NFC"));const O=u=>{const p={},s=(u,h)=>{const g=p[u]||new Set,oe=new RegExp("^"+n(g)+"$","iu");h.match(oe)||(g.add(r(h)),p[u]=g)};for(let p of function*(u){for(const[p,h]of u)for(let u=p;u<=h;u++){let p=String.fromCharCode(u),h=v(p);h!=p.toLowerCase()&&(h.length>3||0!=h.length&&(yield{folded:h,composed:p,code_point:u}))}}(u))s(p.folded,p.folded),s(p.folded,p.composed);return p},b=u=>{const p=O(u),h={};let oe=[];for(let u in p){let g=p[u];g&&(h[u]=n(g)),u.length>1&&oe.push(r(u))}oe.sort(((u,p)=>p.length-u.length));const re=s(oe);return g=new RegExp("^"+re,"u"),h},w=(u,p=1)=>(p=Math.max(p,u.length-1),s(c(u).map((u=>((u,p=1)=>{let g=0;return u=u.map((u=>(h[u]&&(g+=u.length),h[u]||u))),g>=p?i(u):""})(u,p))))),_=(u,p=!0)=>{let h=u.length>1?1:0;return s(u.map((u=>{let g=[];const oe=p?u.length():u.length()-1;for(let p=0;p<oe;p++)g.push(w(u.substrs[p]||"",h));return i(g)})))},C=(u,p)=>{for(const h of p){if(h.start!=u.start||h.end!=u.end)continue;if(h.substrs.join("")!==u.substrs.join(""))continue;let p=u.parts;const i=u=>{for(const h of p){if(h.start===u.start&&h.substr===u.substr)return!1;if(1!=u.length&&1!=h.length){if(u.start<h.start&&u.end>h.start)return!0;if(h.start<u.start&&h.end>u.start)return!0}}return!1};if(!(h.parts.filter(i).length>0))return!0}return!1};class S{parts;substrs;start;end;constructor(){this.parts=[],this.substrs=[],this.start=0,this.end=0}add(u){u&&(this.parts.push(u),this.substrs.push(u.substr),this.start=Math.min(u.start,this.start),this.end=Math.max(u.end,this.end))}last(){return this.parts[this.parts.length-1]}length(){return this.parts.length}clone(u,p){let h=new S,g=JSON.parse(JSON.stringify(this.parts)),oe=g.pop();for(const u of g)h.add(u);let re=p.substr.substring(0,u-oe.start),ae=re.length;return h.add({start:oe.start,end:oe.start+ae,length:ae,substr:re}),h}}const I=u=>{void 0===h&&(h=b(p)),u=v(u);let oe="",re=[new S];for(let p=0;p<u.length;p++){let h=u.substring(p).match(g);const ae=u.substring(p,p+1),de=h?h[0]:null;let ue=[],pe=new Set;for(const u of re){const h=u.last();if(!h||1==h.length||h.end<=p)if(de){const h=de.length;u.add({start:p,end:p+h,length:h,substr:de}),pe.add("1")}else u.add({start:p,end:p+1,length:1,substr:ae}),pe.add("2");else if(de){let g=u.clone(p,h);const oe=de.length;g.add({start:p,end:p+oe,length:oe,substr:de}),ue.push(g)}else pe.add("3")}if(ue.length>0){ue=ue.sort(((u,p)=>u.length()-p.length()));for(let u of ue)C(u,re)||re.push(u)}else if(p>0&&1==pe.size&&!pe.has("3")){oe+=_(re,!1);let u=new S;const p=re[0];p&&u.add(p.last()),re=[u]}}return oe+=_(re,!0),oe},A=(u,p)=>{if(u)return u[p]},k=(u,p)=>{if(u){for(var h,g=p.split(".");(h=g.shift())&&(u=u[h]););return u}},x=(u,p,h)=>{var g,oe;return u?(u+="",null==p.regex||-1===(oe=u.search(p.regex))?0:(g=p.string.length/u.length,0===oe&&(g+=.5),g*h)):0},F=(u,p)=>{var h=u[p];if("function"==typeof h)return h;h&&!Array.isArray(h)&&(u[p]=[h])},L=(u,p)=>{if(Array.isArray(u))u.forEach(p);else for(var h in u)u.hasOwnProperty(h)&&p(u[h],h)},E=(u,p)=>"number"==typeof u&&"number"==typeof p?u>p?1:u<p?-1:0:(u=v(u+"").toLowerCase())>(p=v(p+"").toLowerCase())?1:p>u?-1:0;class T{items;settings;constructor(u,p){this.items=u,this.settings=p||{diacritics:!0}}tokenize(u,p,h){if(!u||!u.length)return[];const g=[],oe=u.split(/\s+/);var re;return h&&(re=new RegExp("^("+Object.keys(h).map(r).join("|")+"):(.*)$")),oe.forEach((u=>{let h,oe=null,ae=null;re&&(h=u.match(re))&&(oe=h[1],u=h[2]),u.length>0&&(ae=this.settings.diacritics?I(u)||null:r(u),ae&&p&&(ae="\\b"+ae)),g.push({string:u,regex:ae?new RegExp(ae,"iu"):null,field:oe})})),g}getScoreFunction(u,p){var h=this.prepareSearch(u,p);return this._getScoreFunction(h)}_getScoreFunction(u){const p=u.tokens,h=p.length;if(!h)return function(){return 0};const g=u.options.fields,oe=u.weights,re=g.length,ae=u.getAttrFn;if(!re)return function(){return 1};const de=1===re?function(u,p){const h=g[0].field;return x(ae(p,h),u,oe[h]||1)}:function(u,p){var h=0;if(u.field){const g=ae(p,u.field);!u.regex&&g?h+=1/re:h+=x(g,u,1)}else L(oe,((g,oe)=>{h+=x(ae(p,oe),u,g)}));return h/re};return 1===h?function(u){return de(p[0],u)}:"and"===u.options.conjunction?function(u){var g,oe=0;for(let h of p){if((g=de(h,u))<=0)return 0;oe+=g}return oe/h}:function(u){var g=0;return L(p,(p=>{g+=de(p,u)})),g/h}}getSortFunction(u,p){var h=this.prepareSearch(u,p);return this._getSortFunction(h)}_getSortFunction(u){var p,h=[];const g=this,oe=u.options,re=!u.query&&oe.sort_empty?oe.sort_empty:oe.sort;if("function"==typeof re)return re.bind(this);const r=function(p,h){return"$score"===p?h.score:u.getAttrFn(g.items[h.id],p)};if(re)for(let p of re)(u.query||"$score"!==p.field)&&h.push(p);if(u.query){p=!0;for(let u of h)if("$score"===u.field){p=!1;break}p&&h.unshift({field:"$score",direction:"desc"})}else h=h.filter((u=>"$score"!==u.field));return h.length?function(u,p){var g,oe;for(let re of h)if(oe=re.field,g=("desc"===re.direction?-1:1)*E(r(oe,u),r(oe,p)))return g;return 0}:null}prepareSearch(u,p){const h={};var g=Object.assign({},p);if(F(g,"sort"),F(g,"sort_empty"),g.fields){F(g,"fields");const u=[];g.fields.forEach((p=>{"string"==typeof p&&(p={field:p,weight:1}),u.push(p),h[p.field]="weight"in p?p.weight:1})),g.fields=u}return{options:g,query:u.toLowerCase().trim(),tokens:this.tokenize(u,g.respect_word_boundaries,h),total:0,items:[],weights:h,getAttrFn:g.nesting?k:A}}search(u,p){var h,g,oe=this;g=this.prepareSearch(u,p),p=g.options,u=g.query;const re=p.score||oe._getScoreFunction(g);u.length?L(oe.items,((u,oe)=>{h=re(u),(!1===p.filter||h>0)&&g.items.push({score:h,id:oe})})):L(oe.items,((u,p)=>{g.items.push({score:1,id:p})}));const ae=oe._getSortFunction(g);return ae&&g.items.sort(ae),g.total=g.items.length,"number"==typeof p.limit&&(g.items=g.items.slice(0,p.limit)),g}}const P=u=>null==u?null:N(u),N=u=>"boolean"==typeof u?u?"1":"0":u+"",j=u=>(u+"").replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"),$=(p,h)=>{var g;return function(oe,re){var ae=this||u;g&&(ae.loading=Math.max(ae.loading-1,0),clearTimeout(g)),g=setTimeout((function(){g=null,ae.loadedSearches[oe]=!0,p.call(ae,oe,re)}),h)}},V=(u,p,h)=>{var g,oe=u.trigger,re={};for(g of(u.trigger=function(){var h=arguments[0];if(-1===p.indexOf(h))return oe.apply(u,arguments);re[h]=arguments},h.apply(u,[]),u.trigger=oe,p))g in re&&oe.apply(u,re[g])},q=(u,p=!1)=>{u&&(u.preventDefault(),p&&u.stopPropagation())},D=(u,p,h,g)=>{u.addEventListener(p,h,g)},H=(u,p)=>!!p&&!!p[u]&&1===(p.altKey?1:0)+(p.ctrlKey?1:0)+(p.shiftKey?1:0)+(p.metaKey?1:0),R=(u,p)=>{const h=u.getAttribute("id");return h||(u.setAttribute("id",p),p)},M=u=>u.replace(/[\\"']/g,"\\$&"),z=(u,p)=>{p&&u.append(p)},B=(u,p)=>{if(Array.isArray(u))u.forEach(p);else for(var h in u)u.hasOwnProperty(h)&&p(u[h],h)},K=u=>{if(u.jquery)return u[0];if(u instanceof HTMLElement)return u;if(Q(u)){var p=document.createElement("template");return p.innerHTML=u.trim(),p.content.firstChild}return document.querySelector(u)},Q=u=>"string"==typeof u&&u.indexOf("<")>-1,G=(u,p)=>{var h=document.createEvent("HTMLEvents");h.initEvent(p,!0,!1),u.dispatchEvent(h)},U=(u,p)=>{Object.assign(u.style,p)},J=(u,...p)=>{var h=X(p);(u=Y(u)).map((u=>{h.map((p=>{u.classList.add(p)}))}))},W=(u,...p)=>{var h=X(p);(u=Y(u)).map((u=>{h.map((p=>{u.classList.remove(p)}))}))},X=u=>{var p=[];return B(u,(u=>{"string"==typeof u&&(u=u.trim().split(/[\t\n\f\r\s]/)),Array.isArray(u)&&(p=p.concat(u))})),p.filter(Boolean)},Y=u=>(Array.isArray(u)||(u=[u]),u),Z=(u,p,h)=>{if(!h||h.contains(u))for(;u&&u.matches;){if(u.matches(p))return u;u=u.parentNode}},ee=(u,p=0)=>p>0?u[u.length-1]:u[0],te=(u,p)=>{if(!u)return-1;p=p||u.nodeName;for(var h=0;u=u.previousElementSibling;)u.matches(p)&&h++;return h},se=(u,p)=>{B(p,((p,h)=>{null==p?u.removeAttribute(h):u.setAttribute(h,""+p)}))},ie=(u,p)=>{u.parentNode&&u.parentNode.replaceChild(p,u)},ne=(u,p)=>{if(null===p)return;if("string"==typeof p){if(!p.length)return;p=new RegExp(p,"i")}const s=u=>3===u.nodeType?(u=>{var h=u.data.match(p);if(h&&u.data.length>0){var g=document.createElement("span");g.className="highlight";var oe=u.splitText(h.index);oe.splitText(h[0].length);var re=oe.cloneNode(!0);return g.appendChild(re),ie(oe,g),1}return 0})(u):((u=>{1!==u.nodeType||!u.childNodes||/(script|style)/i.test(u.tagName)||"highlight"===u.className&&"SPAN"===u.tagName||Array.from(u.childNodes).forEach((u=>{s(u)}))})(u),0);s(u)},de="undefined"!=typeof navigator&&/Mac/.test(navigator.userAgent)?"metaKey":"ctrlKey";var ue={options:[],optgroups:[],plugins:[],delimiter:",",splitOn:null,persist:!0,diacritics:!0,create:null,createOnBlur:!1,createFilter:null,highlight:!0,openOnFocus:!0,shouldOpen:null,maxOptions:50,maxItems:null,hideSelected:null,duplicates:!1,addPrecedence:!1,selectOnTab:!1,preload:null,allowEmptyOption:!1,refreshThrottle:300,loadThrottle:300,loadingClass:"loading",dataAttr:null,optgroupField:"optgroup",valueField:"value",labelField:"text",disabledField:"disabled",optgroupLabelField:"label",optgroupValueField:"value",lockOptgroupOrder:!1,sortField:"$order",searchField:["text"],searchConjunction:"and",mode:null,wrapperClass:"ts-wrapper",controlClass:"ts-control",dropdownClass:"ts-dropdown",dropdownContentClass:"ts-dropdown-content",itemClass:"item",optionClass:"option",dropdownParent:null,controlInput:'<input type="text" autocomplete="off" size="1" />',copyClassesToDropdown:!1,placeholder:null,hidePlaceholder:null,shouldLoad:function(u){return u.length>0},render:{}};function le(u,p){var h=Object.assign({},ue,p),g=h.dataAttr,oe=h.labelField,re=h.valueField,ae=h.disabledField,de=h.optgroupField,pe=h.optgroupLabelField,he=h.optgroupValueField,ge=u.tagName.toLowerCase(),fe=u.getAttribute("placeholder")||u.getAttribute("data-placeholder");if(!fe&&!h.allowEmptyOption){let p=u.querySelector('option[value=""]');p&&(fe=p.textContent)}var ve={placeholder:fe,options:[],optgroups:[],items:[],maxItems:null};return"select"===ge?(()=>{var p,ue=ve.options,ge={},fe=1;let me=0;var f=u=>{var p=Object.assign({},u.dataset),h=g&&p[g];return"string"==typeof h&&h.length&&(p=Object.assign(p,JSON.parse(h))),p},m=(u,p)=>{var g=P(u.value);if(null!=g&&(g||h.allowEmptyOption)){if(ge.hasOwnProperty(g)){if(p){var pe=ge[g][de];pe?Array.isArray(pe)?pe.push(p):ge[g][de]=[pe,p]:ge[g][de]=p}}else{var he=f(u);he[oe]=he[oe]||u.textContent,he[re]=he[re]||g,he[ae]=he[ae]||u.disabled,he[de]=he[de]||p,he.$option=u,he.$order=he.$order||++me,ge[g]=he,ue.push(he)}u.selected&&ve.items.push(g)}};ve.maxItems=u.hasAttribute("multiple")?null:1,B(u.children,(u=>{var h,g,oe;"optgroup"===(p=u.tagName.toLowerCase())?((oe=f(h=u))[pe]=oe[pe]||h.getAttribute("label")||"",oe[he]=oe[he]||fe++,oe[ae]=oe[ae]||h.disabled,oe.$order=oe.$order||++me,ve.optgroups.push(oe),g=oe[he],B(h.children,(u=>{m(u,g)}))):"option"===p&&m(u)}))})():(()=>{const p=u.getAttribute(g);if(p)ve.options=JSON.parse(p),B(ve.options,(u=>{ve.items.push(u[re])}));else{var ae=u.value.trim()||"";if(!h.allowEmptyOption&&!ae.length)return;const p=ae.split(h.delimiter);B(p,(u=>{const p={};p[oe]=u,p[re]=u,ve.options.push(p)})),ve.items=p}})(),Object.assign({},ue,ve,p)}var pe=0;class ce extends(function(u){return u.plugins={},class extends u{constructor(...u){super(...u),this.plugins={names:[],settings:{},requested:{},loaded:{}}}static define(p,h){u.plugins[p]={name:p,fn:h}}initializePlugins(u){var p,h;const g=this,oe=[];if(Array.isArray(u))u.forEach((u=>{"string"==typeof u?oe.push(u):(g.plugins.settings[u.name]=u.options,oe.push(u.name))}));else if(u)for(p in u)u.hasOwnProperty(p)&&(g.plugins.settings[p]=u[p],oe.push(p));for(;h=oe.shift();)g.require(h)}loadPlugin(p){var h=this,g=h.plugins,oe=u.plugins[p];if(!u.plugins.hasOwnProperty(p))throw new Error('Unable to find "'+p+'" plugin');g.requested[p]=!0,g.loaded[p]=oe.fn.apply(h,[h.plugins.settings[p]||{}]),g.names.push(p)}require(u){var p=this,h=p.plugins;if(!p.plugins.loaded.hasOwnProperty(u)){if(h.requested[u])throw new Error('Plugin has circular dependency ("'+u+'")');p.loadPlugin(u)}return h.loaded[u]}}}(t)){constructor(u,p){var h;super(),this.order=0,this.isOpen=!1,this.isDisabled=!1,this.isReadOnly=!1,this.isInvalid=!1,this.isValid=!0,this.isLocked=!1,this.isFocused=!1,this.isInputHidden=!1,this.isSetup=!1,this.ignoreFocus=!1,this.ignoreHover=!1,this.hasOptions=!1,this.lastValue="",this.caretPos=0,this.loading=0,this.loadedSearches={},this.activeOption=null,this.activeItems=[],this.optgroups={},this.options={},this.userOptions={},this.items=[],this.refreshTimeout=null,pe++;var g=K(u);if(g.tomselect)throw new Error("Tom Select already initialized on this element");g.tomselect=this,h=(window.getComputedStyle&&window.getComputedStyle(g,null)).getPropertyValue("direction");const oe=le(g,p);this.settings=oe,this.input=g,this.tabIndex=g.tabIndex||0,this.is_select_tag="select"===g.tagName.toLowerCase(),this.rtl=/rtl/i.test(h),this.inputId=R(g,"tomselect-"+pe),this.isRequired=g.required,this.sifter=new T(this.options,{diacritics:oe.diacritics}),oe.mode=oe.mode||(1===oe.maxItems?"single":"multi"),"boolean"!=typeof oe.hideSelected&&(oe.hideSelected="multi"===oe.mode),"boolean"!=typeof oe.hidePlaceholder&&(oe.hidePlaceholder="multi"!==oe.mode);var re=oe.createFilter;"function"!=typeof re&&("string"==typeof re&&(re=new RegExp(re)),re instanceof RegExp?oe.createFilter=u=>re.test(u):oe.createFilter=u=>this.settings.duplicates||!this.options[u]),this.initializePlugins(oe.plugins),this.setupCallbacks(),this.setupTemplates();const ae=K("<div>"),de=K("<div>"),ue=this._render("dropdown"),he=K('<div role="listbox" tabindex="-1">'),ge=this.input.getAttribute("class")||"",fe=oe.mode;var ve;if(J(ae,oe.wrapperClass,ge,fe),J(de,oe.controlClass),z(ae,de),J(ue,oe.dropdownClass,fe),oe.copyClassesToDropdown&&J(ue,ge),J(he,oe.dropdownContentClass),z(ue,he),K(oe.dropdownParent||ae).appendChild(ue),Q(oe.controlInput)){ve=K(oe.controlInput);B(["autocorrect","autocapitalize","autocomplete","spellcheck"],(u=>{g.getAttribute(u)&&se(ve,{[u]:g.getAttribute(u)})})),ve.tabIndex=-1,de.appendChild(ve),this.focus_node=ve}else oe.controlInput?(ve=K(oe.controlInput),this.focus_node=ve):(ve=K("<input/>"),this.focus_node=de);this.wrapper=ae,this.dropdown=ue,this.dropdown_content=he,this.control=de,this.control_input=ve,this.setup()}setup(){const u=this,p=u.settings,h=u.control_input,g=u.dropdown,oe=u.dropdown_content,re=u.wrapper,ae=u.control,de=u.input,ue=u.focus_node,pe={passive:!0},he=u.inputId+"-ts-dropdown";se(oe,{id:he}),se(ue,{role:"combobox","aria-haspopup":"listbox","aria-expanded":"false","aria-controls":he});const ge=R(ue,u.inputId+"-ts-control"),fe="label[for='"+(u=>u.replace(/['"\\]/g,"\\$&"))(u.inputId)+"']",ve=document.querySelector(fe),me=u.focus.bind(u);if(ve){D(ve,"click",me),se(ve,{for:ge});const p=R(ve,u.inputId+"-ts-label");se(ue,{"aria-labelledby":p}),se(oe,{"aria-labelledby":p})}if(re.style.width=de.style.width,u.plugins.names.length){const p="plugin-"+u.plugins.names.join(" plugin-");J([re,g],p)}(null===p.maxItems||p.maxItems>1)&&u.is_select_tag&&se(de,{multiple:"multiple"}),p.placeholder&&se(h,{placeholder:p.placeholder}),!p.splitOn&&p.delimiter&&(p.splitOn=new RegExp("\\s*"+r(p.delimiter)+"+\\s*")),p.load&&p.loadThrottle&&(p.load=$(p.load,p.loadThrottle)),D(g,"mousemove",(()=>{u.ignoreHover=!1})),D(g,"mouseenter",(p=>{var h=Z(p.target,"[data-selectable]",g);h&&u.onOptionHover(p,h)}),{capture:!0}),D(g,"click",(p=>{const h=Z(p.target,"[data-selectable]");h&&(u.onOptionSelect(p,h),q(p,!0))})),D(ae,"click",(p=>{var g=Z(p.target,"[data-ts-item]",ae);g&&u.onItemSelect(p,g)?q(p,!0):""==h.value&&(u.onClick(),q(p,!0))})),D(ue,"keydown",(p=>u.onKeyDown(p))),D(h,"keypress",(p=>u.onKeyPress(p))),D(h,"input",(p=>u.onInput(p))),D(ue,"blur",(p=>u.onBlur(p))),D(ue,"focus",(p=>u.onFocus(p))),D(h,"paste",(p=>u.onPaste(p)));const m=p=>{const oe=p.composedPath()[0];if(!re.contains(oe)&&!g.contains(oe))return u.isFocused&&u.blur(),void u.inputState();oe==h&&u.isOpen?p.stopPropagation():q(p,!0)},v=()=>{u.isOpen&&u.positionDropdown()};D(document,"mousedown",m),D(window,"scroll",v,pe),D(window,"resize",v,pe),this._destroy=()=>{document.removeEventListener("mousedown",m),window.removeEventListener("scroll",v),window.removeEventListener("resize",v),ve&&ve.removeEventListener("click",me)},this.revertSettings={innerHTML:de.innerHTML,tabIndex:de.tabIndex},de.tabIndex=-1,de.insertAdjacentElement("afterend",u.wrapper),u.sync(!1),p.items=[],delete p.optgroups,delete p.options,D(de,"invalid",(()=>{u.isValid&&(u.isValid=!1,u.isInvalid=!0,u.refreshState())})),u.updateOriginalInput(),u.refreshItems(),u.close(!1),u.inputState(),u.isSetup=!0,de.disabled?u.disable():de.readOnly?u.setReadOnly(!0):u.enable(),u.on("change",this.onChange),J(de,"tomselected","ts-hidden-accessible"),u.trigger("initialize"),!0===p.preload&&u.preload()}setupOptions(u=[],p=[]){this.addOptions(u),B(p,(u=>{this.registerOptionGroup(u)}))}setupTemplates(){var u=this,p=u.settings.labelField,h=u.settings.optgroupLabelField,g={optgroup:u=>{let p=document.createElement("div");return p.className="optgroup",p.appendChild(u.options),p},optgroup_header:(u,p)=>'<div class="optgroup-header">'+p(u[h])+"</div>",option:(u,h)=>"<div>"+h(u[p])+"</div>",item:(u,h)=>"<div>"+h(u[p])+"</div>",option_create:(u,p)=>'<div class="create">Add <strong>'+p(u.input)+"</strong>&hellip;</div>",no_results:()=>'<div class="no-results">No results found</div>',loading:()=>'<div class="spinner"></div>',not_loading:()=>{},dropdown:()=>"<div></div>"};u.settings.render=Object.assign({},g,u.settings.render)}setupCallbacks(){var u,p,h={initialize:"onInitialize",change:"onChange",item_add:"onItemAdd",item_remove:"onItemRemove",item_select:"onItemSelect",clear:"onClear",option_add:"onOptionAdd",option_remove:"onOptionRemove",option_clear:"onOptionClear",optgroup_add:"onOptionGroupAdd",optgroup_remove:"onOptionGroupRemove",optgroup_clear:"onOptionGroupClear",dropdown_open:"onDropdownOpen",dropdown_close:"onDropdownClose",type:"onType",load:"onLoad",focus:"onFocus",blur:"onBlur"};for(u in h)(p=this.settings[h[u]])&&this.on(u,p)}sync(u=!0){const p=this,h=u?le(p.input,{delimiter:p.settings.delimiter}):p.settings;p.setupOptions(h.options,h.optgroups),p.setValue(h.items||[],!0),p.lastQuery=null}onClick(){var u=this;if(u.activeItems.length>0)return u.clearActiveItems(),void u.focus();u.isFocused&&u.isOpen?u.blur():u.focus()}onMouseDown(){}onChange(){G(this.input,"input"),G(this.input,"change")}onPaste(u){var p=this;p.isInputHidden||p.isLocked?q(u):p.settings.splitOn&&setTimeout((()=>{var u=p.inputValue();if(u.match(p.settings.splitOn)){var h=u.trim().split(p.settings.splitOn);B(h,(u=>{P(u)&&(this.options[u]?p.addItem(u):p.createItem(u))}))}}),0)}onKeyPress(u){var p=this;if(!p.isLocked){var h=String.fromCharCode(u.keyCode||u.which);return p.settings.create&&"multi"===p.settings.mode&&h===p.settings.delimiter?(p.createItem(),void q(u)):void 0}q(u)}onKeyDown(u){var p=this;if(p.ignoreHover=!0,p.isLocked)9!==u.keyCode&&q(u);else{switch(u.keyCode){case 65:if(H(de,u)&&""==p.control_input.value)return q(u),void p.selectAll();break;case 27:return p.isOpen&&(q(u,!0),p.close()),void p.clearActiveItems();case 40:if(!p.isOpen&&p.hasOptions)p.open();else if(p.activeOption){let u=p.getAdjacent(p.activeOption,1);u&&p.setActiveOption(u)}return void q(u);case 38:if(p.activeOption){let u=p.getAdjacent(p.activeOption,-1);u&&p.setActiveOption(u)}return void q(u);case 13:return void(p.canSelect(p.activeOption)?(p.onOptionSelect(u,p.activeOption),q(u)):(p.settings.create&&p.createItem()||document.activeElement==p.control_input&&p.isOpen)&&q(u));case 37:return void p.advanceSelection(-1,u);case 39:return void p.advanceSelection(1,u);case 9:return void(p.settings.selectOnTab&&(p.canSelect(p.activeOption)&&(p.onOptionSelect(u,p.activeOption),q(u)),p.settings.create&&p.createItem()&&q(u)));case 8:case 46:return void p.deleteSelection(u)}p.isInputHidden&&!H(de,u)&&q(u)}}onInput(u){if(this.isLocked)return;const p=this.inputValue();this.lastValue!==p&&(this.lastValue=p,""!=p?(this.refreshTimeout&&window.clearTimeout(this.refreshTimeout),this.refreshTimeout=((u,p)=>p>0?window.setTimeout(u,p):(u.call(null),null))((()=>{this.refreshTimeout=null,this._onInput()}),this.settings.refreshThrottle)):this._onInput())}_onInput(){const u=this.lastValue;this.settings.shouldLoad.call(this,u)&&this.load(u),this.refreshOptions(),this.trigger("type",u)}onOptionHover(u,p){this.ignoreHover||this.setActiveOption(p,!1)}onFocus(u){var p=this,h=p.isFocused;if(p.isDisabled||p.isReadOnly)return p.blur(),void q(u);p.ignoreFocus||(p.isFocused=!0,"focus"===p.settings.preload&&p.preload(),h||p.trigger("focus"),p.activeItems.length||(p.inputState(),p.refreshOptions(!!p.settings.openOnFocus)),p.refreshState())}onBlur(u){if(!1!==document.hasFocus()){var p=this;if(p.isFocused){p.isFocused=!1,p.ignoreFocus=!1;var s=()=>{p.close(),p.setActiveItem(),p.setCaret(p.items.length),p.trigger("blur")};p.settings.create&&p.settings.createOnBlur?p.createItem(null,s):s()}}}onOptionSelect(u,p){var h,g=this;p.parentElement&&p.parentElement.matches("[data-disabled]")||(p.classList.contains("create")?g.createItem(null,(()=>{g.settings.closeAfterSelect&&g.close()})):void 0!==(h=p.dataset.value)&&(g.lastQuery=null,g.addItem(h),g.settings.closeAfterSelect&&g.close(),!g.settings.hideSelected&&u.type&&/click/.test(u.type)&&g.setActiveOption(p)))}canSelect(u){return!!(this.isOpen&&u&&this.dropdown_content.contains(u))}onItemSelect(u,p){var h=this;return!h.isLocked&&"multi"===h.settings.mode&&(q(u),h.setActiveItem(p,u),!0)}canLoad(u){return!!this.settings.load&&!this.loadedSearches.hasOwnProperty(u)}load(u){const p=this;if(!p.canLoad(u))return;J(p.wrapper,p.settings.loadingClass),p.loading++;const h=p.loadCallback.bind(p);p.settings.load.call(p,u,h)}loadCallback(u,p){const h=this;h.loading=Math.max(h.loading-1,0),h.lastQuery=null,h.clearActiveOption(),h.setupOptions(u,p),h.refreshOptions(h.isFocused&&!h.isInputHidden),h.loading||W(h.wrapper,h.settings.loadingClass),h.trigger("load",u,p)}preload(){var u=this.wrapper.classList;u.contains("preloaded")||(u.add("preloaded"),this.load(""))}setTextboxValue(u=""){var p=this.control_input;p.value!==u&&(p.value=u,G(p,"update"),this.lastValue=u)}getValue(){return this.is_select_tag&&this.input.hasAttribute("multiple")?this.items:this.items.join(this.settings.delimiter)}setValue(u,p){V(this,p?[]:["change"],(()=>{this.clear(p),this.addItems(u,p)}))}setMaxItems(u){0===u&&(u=null),this.settings.maxItems=u,this.refreshState()}setActiveItem(u,p){var h,g,oe,re,ae,ue,pe=this;if("single"!==pe.settings.mode){if(!u)return pe.clearActiveItems(),void(pe.isFocused&&pe.inputState());if("click"===(h=p&&p.type.toLowerCase())&&H("shiftKey",p)&&pe.activeItems.length){for(ue=pe.getLastActive(),(oe=Array.prototype.indexOf.call(pe.control.children,ue))>(re=Array.prototype.indexOf.call(pe.control.children,u))&&(ae=oe,oe=re,re=ae),g=oe;g<=re;g++)u=pe.control.children[g],-1===pe.activeItems.indexOf(u)&&pe.setActiveItemClass(u);q(p)}else"click"===h&&H(de,p)||"keydown"===h&&H("shiftKey",p)?u.classList.contains("active")?pe.removeActiveItem(u):pe.setActiveItemClass(u):(pe.clearActiveItems(),pe.setActiveItemClass(u));pe.inputState(),pe.isFocused||pe.focus()}}setActiveItemClass(u){const p=this,h=p.control.querySelector(".last-active");h&&W(h,"last-active"),J(u,"active last-active"),p.trigger("item_select",u),-1==p.activeItems.indexOf(u)&&p.activeItems.push(u)}removeActiveItem(u){var p=this.activeItems.indexOf(u);this.activeItems.splice(p,1),W(u,"active")}clearActiveItems(){W(this.activeItems,"active"),this.activeItems=[]}setActiveOption(u,p=!0){u!==this.activeOption&&(this.clearActiveOption(),u&&(this.activeOption=u,se(this.focus_node,{"aria-activedescendant":u.getAttribute("id")}),se(u,{"aria-selected":"true"}),J(u,"active"),p&&this.scrollToOption(u)))}scrollToOption(u,p){if(!u)return;const h=this.dropdown_content,g=h.clientHeight,oe=h.scrollTop||0,re=u.offsetHeight,ae=u.getBoundingClientRect().top-h.getBoundingClientRect().top+oe;ae+re>g+oe?this.scroll(ae-g+re,p):ae<oe&&this.scroll(ae,p)}scroll(u,p){const h=this.dropdown_content;p&&(h.style.scrollBehavior=p),h.scrollTop=u,h.style.scrollBehavior=""}clearActiveOption(){this.activeOption&&(W(this.activeOption,"active"),se(this.activeOption,{"aria-selected":null})),this.activeOption=null,se(this.focus_node,{"aria-activedescendant":null})}selectAll(){const u=this;if("single"===u.settings.mode)return;const p=u.controlChildren();p.length&&(u.inputState(),u.close(),u.activeItems=p,B(p,(p=>{u.setActiveItemClass(p)})))}inputState(){var u=this;u.control.contains(u.control_input)&&(se(u.control_input,{placeholder:u.settings.placeholder}),u.activeItems.length>0||!u.isFocused&&u.settings.hidePlaceholder&&u.items.length>0?(u.setTextboxValue(),u.isInputHidden=!0):(u.settings.hidePlaceholder&&u.items.length>0&&se(u.control_input,{placeholder:""}),u.isInputHidden=!1),u.wrapper.classList.toggle("input-hidden",u.isInputHidden))}inputValue(){return this.control_input.value.trim()}focus(){var u=this;u.isDisabled||u.isReadOnly||(u.ignoreFocus=!0,u.control_input.offsetWidth?u.control_input.focus():u.focus_node.focus(),setTimeout((()=>{u.ignoreFocus=!1,u.onFocus()}),0))}blur(){this.focus_node.blur(),this.onBlur()}getScoreFunction(u){return this.sifter.getScoreFunction(u,this.getSearchOptions())}getSearchOptions(){var u=this.settings,p=u.sortField;return"string"==typeof u.sortField&&(p=[{field:u.sortField}]),{fields:u.searchField,conjunction:u.searchConjunction,sort:p,nesting:u.nesting}}search(u){var p,h,g=this,oe=this.getSearchOptions();if(g.settings.score&&"function"!=typeof(h=g.settings.score.call(g,u)))throw new Error('Tom Select "score" setting must be a function that returns a function');return u!==g.lastQuery?(g.lastQuery=u,p=g.sifter.search(u,Object.assign(oe,{score:h})),g.currentResults=p):p=Object.assign({},g.currentResults),g.settings.hideSelected&&(p.items=p.items.filter((u=>{let p=P(u.id);return!(p&&-1!==g.items.indexOf(p))}))),p}refreshOptions(u=!0){var p,h,g,oe,re,ae,de,ue,pe,he;const ge={},fe=[];var ve=this,me=ve.inputValue();const ye=me===ve.lastQuery||""==me&&null==ve.lastQuery;var Oe=ve.search(me),be=null,we=ve.settings.shouldOpen||!1,_e=ve.dropdown_content;ye&&(be=ve.activeOption)&&(pe=be.closest("[data-group]")),oe=Oe.items.length,"number"==typeof ve.settings.maxOptions&&(oe=Math.min(oe,ve.settings.maxOptions)),oe>0&&(we=!0);const b=(u,p)=>{let h=ge[u];if(void 0!==h){let u=fe[h];if(void 0!==u)return[h,u.fragment]}let g=document.createDocumentFragment();return h=fe.length,fe.push({fragment:g,order:p,optgroup:u}),[h,g]};for(p=0;p<oe;p++){let u=Oe.items[p];if(!u)continue;let oe=u.id,de=ve.options[oe];if(void 0===de)continue;let ue=N(oe),he=ve.getOption(ue,!0);for(ve.settings.hideSelected||he.classList.toggle("selected",ve.items.includes(ue)),re=de[ve.settings.optgroupField]||"",h=0,g=(ae=Array.isArray(re)?re:[re])&&ae.length;h<g;h++){re=ae[h];let u=de.$order,p=ve.optgroups[re];void 0===p?re="":u=p.$order;const[g,ue]=b(re,u);h>0&&(he=he.cloneNode(!0),se(he,{id:de.$id+"-clone-"+h,"aria-selected":null}),he.classList.add("ts-cloned"),W(he,"active"),ve.activeOption&&ve.activeOption.dataset.value==oe&&pe&&pe.dataset.group===re.toString()&&(be=he)),ue.appendChild(he),""!=re&&(ge[re]=g)}}var Se;ve.settings.lockOptgroupOrder&&fe.sort(((u,p)=>u.order-p.order)),de=document.createDocumentFragment(),B(fe,(u=>{let p=u.fragment,h=u.optgroup;if(!p||!p.children.length)return;let g=ve.optgroups[h];if(void 0!==g){let u=document.createDocumentFragment(),h=ve.render("optgroup_header",g);z(u,h),z(u,p);let oe=ve.render("optgroup",{group:g,options:u});z(de,oe)}else z(de,p)})),_e.innerHTML="",z(_e,de),ve.settings.highlight&&(Se=_e.querySelectorAll("span.highlight"),Array.prototype.forEach.call(Se,(function(u){var p=u.parentNode;p.replaceChild(u.firstChild,u),p.normalize()})),Oe.query.length&&Oe.tokens.length&&B(Oe.tokens,(u=>{ne(_e,u.regex)})));var _=u=>{let p=ve.render(u,{input:me});return p&&(we=!0,_e.insertBefore(p,_e.firstChild)),p};if(ve.loading?_("loading"):ve.settings.shouldLoad.call(ve,me)?0===Oe.items.length&&_("no_results"):_("not_loading"),(ue=ve.canCreate(me))&&(he=_("option_create")),ve.hasOptions=Oe.items.length>0||ue,we){if(Oe.items.length>0){if(be||"single"!==ve.settings.mode||null==ve.items[0]||(be=ve.getOption(ve.items[0])),!_e.contains(be)){let u=0;he&&!ve.settings.addPrecedence&&(u=1),be=ve.selectable()[u]}}else he&&(be=he);u&&!ve.isOpen&&(ve.open(),ve.scrollToOption(be,"auto")),ve.setActiveOption(be)}else ve.clearActiveOption(),u&&ve.isOpen&&ve.close(!1)}selectable(){return this.dropdown_content.querySelectorAll("[data-selectable]")}addOption(u,p=!1){const h=this;if(Array.isArray(u))return h.addOptions(u,p),!1;const g=P(u[h.settings.valueField]);return null!==g&&!h.options.hasOwnProperty(g)&&(u.$order=u.$order||++h.order,u.$id=h.inputId+"-opt-"+u.$order,h.options[g]=u,h.lastQuery=null,p&&(h.userOptions[g]=p,h.trigger("option_add",g,u)),g)}addOptions(u,p=!1){B(u,(u=>{this.addOption(u,p)}))}registerOption(u){return this.addOption(u)}registerOptionGroup(u){var p=P(u[this.settings.optgroupValueField]);return null!==p&&(u.$order=u.$order||++this.order,this.optgroups[p]=u,p)}addOptionGroup(u,p){var h;p[this.settings.optgroupValueField]=u,(h=this.registerOptionGroup(p))&&this.trigger("optgroup_add",h,p)}removeOptionGroup(u){this.optgroups.hasOwnProperty(u)&&(delete this.optgroups[u],this.clearCache(),this.trigger("optgroup_remove",u))}clearOptionGroups(){this.optgroups={},this.clearCache(),this.trigger("optgroup_clear")}updateOption(u,p){const h=this;var g,oe;const re=P(u),ae=P(p[h.settings.valueField]);if(null===re)return;const de=h.options[re];if(null==de)return;if("string"!=typeof ae)throw new Error("Value must be set in option data");const ue=h.getOption(re),pe=h.getItem(re);if(p.$order=p.$order||de.$order,delete h.options[re],h.uncacheValue(ae),h.options[ae]=p,ue){if(h.dropdown_content.contains(ue)){const u=h._render("option",p);ie(ue,u),h.activeOption===ue&&h.setActiveOption(u)}ue.remove()}pe&&(-1!==(oe=h.items.indexOf(re))&&h.items.splice(oe,1,ae),g=h._render("item",p),pe.classList.contains("active")&&J(g,"active"),ie(pe,g)),h.lastQuery=null}removeOption(u,p){const h=this;u=N(u),h.uncacheValue(u),delete h.userOptions[u],delete h.options[u],h.lastQuery=null,h.trigger("option_remove",u),h.removeItem(u,p)}clearOptions(u){const p=(u||this.clearFilter).bind(this);this.loadedSearches={},this.userOptions={},this.clearCache();const h={};B(this.options,((u,g)=>{p(u,g)&&(h[g]=u)})),this.options=this.sifter.items=h,this.lastQuery=null,this.trigger("option_clear")}clearFilter(u,p){return this.items.indexOf(p)>=0}getOption(u,p=!1){const h=P(u);if(null===h)return null;const g=this.options[h];if(null!=g){if(g.$div)return g.$div;if(p)return this._render("option",g)}return null}getAdjacent(u,p,h="option"){var g;if(!u)return null;g="item"==h?this.controlChildren():this.dropdown_content.querySelectorAll("[data-selectable]");for(let h=0;h<g.length;h++)if(g[h]==u)return p>0?g[h+1]:g[h-1];return null}getItem(u){if("object"==typeof u)return u;var p=P(u);return null!==p?this.control.querySelector(`[data-value="${M(p)}"]`):null}addItems(u,p){var h=this,g=Array.isArray(u)?u:[u];const oe=(g=g.filter((u=>-1===h.items.indexOf(u))))[g.length-1];g.forEach((u=>{h.isPending=u!==oe,h.addItem(u,p)}))}addItem(u,p){V(this,p?[]:["change","dropdown_close"],(()=>{var h,g;const oe=this,re=oe.settings.mode,ae=P(u);if((!ae||-1===oe.items.indexOf(ae)||("single"===re&&oe.close(),"single"!==re&&oe.settings.duplicates))&&null!==ae&&oe.options.hasOwnProperty(ae)&&("single"===re&&oe.clear(p),"multi"!==re||!oe.isFull())){if(h=oe._render("item",oe.options[ae]),oe.control.contains(h)&&(h=h.cloneNode(!0)),g=oe.isFull(),oe.items.splice(oe.caretPos,0,ae),oe.insertAtCaret(h),oe.isSetup){if(!oe.isPending&&oe.settings.hideSelected){let u=oe.getOption(ae),p=oe.getAdjacent(u,1);p&&oe.setActiveOption(p)}oe.isPending||oe.settings.closeAfterSelect||oe.refreshOptions(oe.isFocused&&"single"!==re),0!=oe.settings.closeAfterSelect&&oe.isFull()?oe.close():oe.isPending||oe.positionDropdown(),oe.trigger("item_add",ae,h),oe.isPending||oe.updateOriginalInput({silent:p})}(!oe.isPending||!g&&oe.isFull())&&(oe.inputState(),oe.refreshState())}}))}removeItem(u=null,p){const h=this;if(!(u=h.getItem(u)))return;var g,oe;const re=u.dataset.value;g=te(u),u.remove(),u.classList.contains("active")&&(oe=h.activeItems.indexOf(u),h.activeItems.splice(oe,1),W(u,"active")),h.items.splice(g,1),h.lastQuery=null,!h.settings.persist&&h.userOptions.hasOwnProperty(re)&&h.removeOption(re,p),g<h.caretPos&&h.setCaret(h.caretPos-1),h.updateOriginalInput({silent:p}),h.refreshState(),h.positionDropdown(),h.trigger("item_remove",re,u)}createItem(u=null,p=()=>{}){3===arguments.length&&(p=arguments[2]),"function"!=typeof p&&(p=()=>{});var h,g=this,oe=g.caretPos;if(u=u||g.inputValue(),!g.canCreate(u))return p(),!1;g.lock();var re=!1,r=u=>{if(g.unlock(),!u||"object"!=typeof u)return p();var h=P(u[g.settings.valueField]);if("string"!=typeof h)return p();g.setTextboxValue(),g.addOption(u,!0),g.setCaret(oe),g.addItem(h),p(u),re=!0};return h="function"==typeof g.settings.create?g.settings.create.call(this,u,r):{[g.settings.labelField]:u,[g.settings.valueField]:u},re||r(h),!0}refreshItems(){var u=this;u.lastQuery=null,u.isSetup&&u.addItems(u.items),u.updateOriginalInput(),u.refreshState()}refreshState(){const u=this;u.refreshValidityState();const p=u.isFull(),h=u.isLocked;u.wrapper.classList.toggle("rtl",u.rtl);const g=u.wrapper.classList;var oe;g.toggle("focus",u.isFocused),g.toggle("disabled",u.isDisabled),g.toggle("readonly",u.isReadOnly),g.toggle("required",u.isRequired),g.toggle("invalid",!u.isValid),g.toggle("locked",h),g.toggle("full",p),g.toggle("input-active",u.isFocused&&!u.isInputHidden),g.toggle("dropdown-active",u.isOpen),g.toggle("has-options",(oe=u.options,0===Object.keys(oe).length)),g.toggle("has-items",u.items.length>0)}refreshValidityState(){var u=this;u.input.validity&&(u.isValid=u.input.validity.valid,u.isInvalid=!u.isValid)}isFull(){return null!==this.settings.maxItems&&this.items.length>=this.settings.maxItems}updateOriginalInput(u={}){const p=this;var h,g;const oe=p.input.querySelector('option[value=""]');if(p.is_select_tag){const re=[],ae=p.input.querySelectorAll("option:checked").length;function l(u,h,g){return u||(u=K('<option value="'+j(h)+'">'+j(g)+"</option>")),u!=oe&&p.input.append(u),re.push(u),(u!=oe||ae>0)&&(u.selected=!0),u}p.input.querySelectorAll("option:checked").forEach((u=>{u.selected=!1})),0==p.items.length&&"single"==p.settings.mode?l(oe,"",""):p.items.forEach((u=>{h=p.options[u],g=h[p.settings.labelField]||"",re.includes(h.$option)?l(p.input.querySelector(`option[value="${M(u)}"]:not(:checked)`),u,g):h.$option=l(h.$option,u,g)}))}else p.input.value=p.getValue();p.isSetup&&(u.silent||p.trigger("change",p.getValue()))}open(){var u=this;u.isLocked||u.isOpen||"multi"===u.settings.mode&&u.isFull()||(u.isOpen=!0,se(u.focus_node,{"aria-expanded":"true"}),u.refreshState(),U(u.dropdown,{visibility:"hidden",display:"block"}),u.positionDropdown(),U(u.dropdown,{visibility:"visible",display:"block"}),u.focus(),u.trigger("dropdown_open",u.dropdown))}close(u=!0){var p=this,h=p.isOpen;u&&(p.setTextboxValue(),"single"===p.settings.mode&&p.items.length&&p.inputState()),p.isOpen=!1,se(p.focus_node,{"aria-expanded":"false"}),U(p.dropdown,{display:"none"}),p.settings.hideSelected&&p.clearActiveOption(),p.refreshState(),h&&p.trigger("dropdown_close",p.dropdown)}positionDropdown(){if("body"===this.settings.dropdownParent){var u=this.control,p=u.getBoundingClientRect(),h=u.offsetHeight+p.top+window.scrollY,g=p.left+window.scrollX;U(this.dropdown,{width:p.width+"px",top:h+"px",left:g+"px"})}}clear(u){var p=this;if(p.items.length){var h=p.controlChildren();B(h,(u=>{p.removeItem(u,!0)})),p.inputState(),u||p.updateOriginalInput(),p.trigger("clear")}}insertAtCaret(u){const p=this,h=p.caretPos,g=p.control;g.insertBefore(u,g.children[h]||null),p.setCaret(h+1)}deleteSelection(u){var p,h,g,oe,re,ae=this;p=u&&8===u.keyCode?-1:1,h={start:(re=ae.control_input).selectionStart||0,length:(re.selectionEnd||0)-(re.selectionStart||0)};const de=[];if(ae.activeItems.length)oe=ee(ae.activeItems,p),g=te(oe),p>0&&g++,B(ae.activeItems,(u=>de.push(u)));else if((ae.isFocused||"single"===ae.settings.mode)&&ae.items.length){const u=ae.controlChildren();let g;p<0&&0===h.start&&0===h.length?g=u[ae.caretPos-1]:p>0&&h.start===ae.inputValue().length&&(g=u[ae.caretPos]),void 0!==g&&de.push(g)}if(!ae.shouldDelete(de,u))return!1;for(q(u,!0),void 0!==g&&ae.setCaret(g);de.length;)ae.removeItem(de.pop());return ae.inputState(),ae.positionDropdown(),ae.refreshOptions(!1),!0}shouldDelete(u,p){const h=u.map((u=>u.dataset.value));return!(!h.length||"function"==typeof this.settings.onDelete&&!1===this.settings.onDelete(h,p))}advanceSelection(u,p){var h,g,oe=this;oe.rtl&&(u*=-1),oe.inputValue().length||(H(de,p)||H("shiftKey",p)?(g=(h=oe.getLastActive(u))?h.classList.contains("active")?oe.getAdjacent(h,u,"item"):h:u>0?oe.control_input.nextElementSibling:oe.control_input.previousElementSibling)&&(g.classList.contains("active")&&oe.removeActiveItem(h),oe.setActiveItemClass(g)):oe.moveCaret(u))}moveCaret(u){}getLastActive(u){let p=this.control.querySelector(".last-active");if(p)return p;var h=this.control.querySelectorAll(".active");return h?ee(h,u):void 0}setCaret(u){this.caretPos=this.items.length}controlChildren(){return Array.from(this.control.querySelectorAll("[data-ts-item]"))}lock(){this.setLocked(!0)}unlock(){this.setLocked(!1)}setLocked(u=this.isReadOnly||this.isDisabled){this.isLocked=u,this.refreshState()}disable(){this.setDisabled(!0),this.close()}enable(){this.setDisabled(!1)}setDisabled(u){this.focus_node.tabIndex=u?-1:this.tabIndex,this.isDisabled=u,this.input.disabled=u,this.control_input.disabled=u,this.setLocked()}setReadOnly(u){this.isReadOnly=u,this.input.readOnly=u,this.control_input.readOnly=u,this.setLocked()}destroy(){var u=this,p=u.revertSettings;u.trigger("destroy"),u.off(),u.wrapper.remove(),u.dropdown.remove(),u.input.innerHTML=p.innerHTML,u.input.tabIndex=p.tabIndex,W(u.input,"tomselected","ts-hidden-accessible"),u._destroy(),delete u.input.tomselect}render(u,p){var h,g;const oe=this;if("function"!=typeof this.settings.render[u])return null;if(!(g=oe.settings.render[u].call(this,p,j)))return null;if(g=K(g),"option"===u||"option_create"===u?p[oe.settings.disabledField]?se(g,{"aria-disabled":"true"}):se(g,{"data-selectable":""}):"optgroup"===u&&(h=p.group[oe.settings.optgroupValueField],se(g,{"data-group":h}),p.group[oe.settings.disabledField]&&se(g,{"data-disabled":""})),"option"===u||"item"===u){const h=N(p[oe.settings.valueField]);se(g,{"data-value":h}),"item"===u?(J(g,oe.settings.itemClass),se(g,{"data-ts-item":""})):(J(g,oe.settings.optionClass),se(g,{role:"option",id:p.$id}),p.$div=g,oe.options[h]=p)}return g}_render(u,p){const h=this.render(u,p);if(null==h)throw"HTMLElement expected";return h}clearCache(){B(this.options,(u=>{u.$div&&(u.$div.remove(),delete u.$div)}))}uncacheValue(u){const p=this.getOption(u);p&&p.remove()}canCreate(u){return this.settings.create&&u.length>0&&this.settings.createFilter.call(this,u)}hook(u,p,h){var g=this,oe=g[p];g[p]=function(){var p,re;return"after"===u&&(p=oe.apply(g,arguments)),re=h.apply(g,arguments),"instead"===u?re:("before"===u&&(p=oe.apply(g,arguments)),p)}}}return ce.define("change_listener",(function(){D((this||u).input,"change",(()=>{this.sync()}))})),ce.define("checkbox_options",(function(p){var h=this||u,g=h.onOptionSelect;h.settings.hideSelected=!1;const oe=Object.assign({className:"tomselect-checkbox",checkedClassNames:void 0,uncheckedClassNames:void 0},p);var n=function(u,p){p?(u.checked=!0,oe.uncheckedClassNames&&u.classList.remove(...oe.uncheckedClassNames),oe.checkedClassNames&&u.classList.add(...oe.checkedClassNames)):(u.checked=!1,oe.checkedClassNames&&u.classList.remove(...oe.checkedClassNames),oe.uncheckedClassNames&&u.classList.add(...oe.uncheckedClassNames))},o=function(u){setTimeout((()=>{var p=u.querySelector("input."+oe.className);p instanceof HTMLInputElement&&n(p,u.classList.contains("selected"))}),1)};h.hook("after","setupTemplates",(()=>{var u=h.settings.render.option;h.settings.render.option=(p,g)=>{var re=K(u.call(h,p,g)),ae=document.createElement("input");oe.className&&ae.classList.add(oe.className),ae.addEventListener("click",(function(u){q(u)})),ae.type="checkbox";const de=P(p[h.settings.valueField]);return n(ae,!!(de&&h.items.indexOf(de)>-1)),re.prepend(ae),re}})),h.on("item_remove",(u=>{var p=h.getOption(u);p&&(p.classList.remove("selected"),o(p))})),h.on("item_add",(u=>{var p=h.getOption(u);p&&o(p)})),h.hook("instead","onOptionSelect",((u,p)=>{if(p.classList.contains("selected"))return p.classList.remove("selected"),h.removeItem(p.dataset.value),h.refreshOptions(),void q(u,!0);g.call(h,u,p),o(p)}))})),ce.define("clear_button",(function(p){const h=this||u,g=Object.assign({className:"clear-button",title:"Clear All",html:u=>`<div class="${u.className}" title="${u.title}">&#10799;</div>`},p);h.on("initialize",(()=>{var u=K(g.html(g));u.addEventListener("click",(u=>{h.isLocked||(h.clear(),"single"===h.settings.mode&&h.settings.allowEmptyOption&&h.addItem(""),u.preventDefault(),u.stopPropagation())})),h.control.appendChild(u)}))})),ce.define("drag_drop",(function(){var p=this||u;if("multi"!==p.settings.mode)return;var h=p.lock,g=p.unlock;let oe,re=!0;p.hook("after","setupTemplates",(()=>{var u=p.settings.render.item;p.settings.render.item=(h,g)=>{const ae=K(u.call(p,h,g));se(ae,{draggable:"true"});const l=u=>{u.preventDefault(),ae.classList.add("ts-drag-over"),a(ae,oe)},a=(u,p)=>{var h,g,oe;void 0!==p&&(((u,p)=>{do{var h;if(u==(p=null==(h=p)?void 0:h.previousElementSibling))return!0}while(p&&p.previousElementSibling);return!1})(p,ae)?(g=p,null==(oe=(h=u).parentNode)||oe.insertBefore(g,h.nextSibling)):((u,p)=>{var h;null==(h=u.parentNode)||h.insertBefore(p,u)})(u,p))};return D(ae,"mousedown",(u=>{re||q(u),u.stopPropagation()})),D(ae,"dragstart",(u=>{oe=ae,setTimeout((()=>{ae.classList.add("ts-dragging")}),0)})),D(ae,"dragenter",l),D(ae,"dragover",l),D(ae,"dragleave",(()=>{ae.classList.remove("ts-drag-over")})),D(ae,"dragend",(()=>{var u;document.querySelectorAll(".ts-drag-over").forEach((u=>u.classList.remove("ts-drag-over"))),null==(u=oe)||u.classList.remove("ts-dragging"),oe=void 0;var h=[];p.control.querySelectorAll("[data-value]").forEach((u=>{if(u.dataset.value){let p=u.dataset.value;p&&h.push(p)}})),p.setValue(h)})),ae}})),p.hook("instead","lock",(()=>(re=!1,h.call(p)))),p.hook("instead","unlock",(()=>(re=!0,g.call(p))))})),ce.define("dropdown_header",(function(p){const h=this||u,g=Object.assign({title:"Untitled",headerClass:"dropdown-header",titleRowClass:"dropdown-header-title",labelClass:"dropdown-header-label",closeClass:"dropdown-header-close",html:u=>'<div class="'+u.headerClass+'"><div class="'+u.titleRowClass+'"><span class="'+u.labelClass+'">'+u.title+'</span><a class="'+u.closeClass+'">&times;</a></div></div>'},p);h.on("initialize",(()=>{var u=K(g.html(g)),p=u.querySelector("."+g.closeClass);p&&p.addEventListener("click",(u=>{q(u,!0),h.close()})),h.dropdown.insertBefore(u,h.dropdown.firstChild)}))})),ce.define("caret_position",(function(){var p=this||u;p.hook("instead","setCaret",(u=>{"single"!==p.settings.mode&&p.control.contains(p.control_input)?(u=Math.max(0,Math.min(p.items.length,u)))==p.caretPos||p.isPending||p.controlChildren().forEach(((h,g)=>{g<u?p.control_input.insertAdjacentElement("beforebegin",h):p.control.appendChild(h)})):u=p.items.length,p.caretPos=u})),p.hook("instead","moveCaret",(u=>{if(!p.isFocused)return;const h=p.getLastActive(u);if(h){const g=te(h);p.setCaret(u>0?g+1:g),p.setActiveItem(),W(h,"last-active")}else p.setCaret(p.caretPos+u)}))})),ce.define("dropdown_input",(function(){const p=this||u;p.settings.shouldOpen=!0,p.hook("before","setup",(()=>{p.focus_node=p.control,J(p.control_input,"dropdown-input");const u=K('<div class="dropdown-input-wrap">');u.append(p.control_input),p.dropdown.insertBefore(u,p.dropdown.firstChild);const h=K('<input class="items-placeholder" tabindex="-1" />');h.placeholder=p.settings.placeholder||"",p.control.append(h)})),p.on("initialize",(()=>{p.control_input.addEventListener("keydown",(u=>{switch(u.keyCode){case 27:return p.isOpen&&(q(u,!0),p.close()),void p.clearActiveItems();case 9:p.focus_node.tabIndex=-1}return p.onKeyDown.call(p,u)})),p.on("blur",(()=>{p.focus_node.tabIndex=p.isDisabled?-1:p.tabIndex})),p.on("dropdown_open",(()=>{p.control_input.focus()}));const u=p.onBlur;p.hook("instead","onBlur",(h=>{if(!h||h.relatedTarget!=p.control_input)return u.call(p)})),D(p.control_input,"blur",(()=>p.onBlur())),p.hook("before","close",(()=>{p.isOpen&&p.focus_node.focus({preventScroll:!0})}))}))})),ce.define("input_autogrow",(function(){var p=this||u;p.on("initialize",(()=>{var u=document.createElement("span"),h=p.control_input;u.style.cssText="position:absolute; top:-99999px; left:-99999px; width:auto; padding:0; white-space:pre; ",p.wrapper.appendChild(u);for(const p of["letterSpacing","fontSize","fontFamily","fontWeight","textTransform"])u.style[p]=h.style[p];var i=()=>{u.textContent=h.value,h.style.width=u.clientWidth+"px"};i(),p.on("update item_add item_remove",i),D(h,"input",i),D(h,"keyup",i),D(h,"blur",i),D(h,"update",i)}))})),ce.define("no_backspace_delete",(function(){var p=this||u,h=p.deleteSelection;this.hook("instead","deleteSelection",(u=>!!p.activeItems.length&&h.call(p,u)))})),ce.define("no_active_items",(function(){this.hook("instead","setActiveItem",(()=>{})),this.hook("instead","selectAll",(()=>{}))})),ce.define("optgroup_columns",(function(){var p=this||u,h=p.onKeyDown;p.hook("instead","onKeyDown",(u=>{var g,oe,re,ae;if(!p.isOpen||37!==u.keyCode&&39!==u.keyCode)return h.call(p,u);p.ignoreHover=!0,ae=Z(p.activeOption,"[data-group]"),g=te(p.activeOption,"[data-selectable]"),ae&&(ae=37===u.keyCode?ae.previousSibling:ae.nextSibling)&&(oe=(re=ae.querySelectorAll("[data-selectable]"))[Math.min(re.length-1,g)])&&p.setActiveOption(oe)}))})),ce.define("remove_button",(function(p){const h=Object.assign({label:"&times;",title:"Remove",className:"remove",append:!0},p);var g=this||u;if(h.append){var oe='<a href="javascript:void(0)" class="'+h.className+'" tabindex="-1" title="'+j(h.title)+'">'+h.label+"</a>";g.hook("after","setupTemplates",(()=>{var u=g.settings.render.item;g.settings.render.item=(p,h)=>{var re=K(u.call(g,p,h)),ae=K(oe);return re.appendChild(ae),D(ae,"mousedown",(u=>{q(u,!0)})),D(ae,"click",(u=>{g.isLocked||(q(u,!0),g.isLocked||g.shouldDelete([re],u)&&(g.removeItem(re),g.refreshOptions(!1),g.inputState()))})),re}}))}})),ce.define("restore_on_backspace",(function(p){const h=this||u,g=Object.assign({text:u=>u[h.settings.labelField]},p);h.on("item_remove",(function(u){if(h.isFocused&&""===h.control_input.value.trim()){var p=h.options[u];p&&h.setTextboxValue(g.text.call(h,p))}}))})),ce.define("virtual_scroll",(function(){const p=this||u,h=p.canLoad,g=p.clearActiveOption,oe=p.loadCallback;var re,ae,de={},ue=!1,pe=[];if(p.settings.shouldLoadMore||(p.settings.shouldLoadMore=()=>{if(re.clientHeight/(re.scrollHeight-re.scrollTop)>.9)return!0;if(p.activeOption){var u=p.selectable();if(Array.from(u).indexOf(p.activeOption)>=u.length-2)return!0}return!1}),!p.settings.firstUrl)throw"virtual_scroll plugin requires a firstUrl() method";p.settings.sortField=[{field:"$order"},{field:"$score"}];const c=u=>!("number"==typeof p.settings.maxOptions&&re.children.length>=p.settings.maxOptions)&&!(!(u in de)||!de[u]),d=(u,h)=>p.items.indexOf(h)>=0||pe.indexOf(h)>=0;p.setNextUrl=(u,p)=>{de[u]=p},p.getUrl=u=>{if(u in de){const p=de[u];return de[u]=!1,p}return p.clearPagination(),p.settings.firstUrl.call(p,u)},p.clearPagination=()=>{de={}},p.hook("instead","clearActiveOption",(()=>{if(!ue)return g.call(p)})),p.hook("instead","canLoad",(u=>u in de?c(u):h.call(p,u))),p.hook("instead","loadCallback",((u,h)=>{if(ue){if(ae){const h=u[0];void 0!==h&&(ae.dataset.value=h[p.settings.valueField])}}else p.clearOptions(d);oe.call(p,u,h),ue=!1})),p.hook("after","refreshOptions",(()=>{const u=p.lastValue;var h;c(u)?(h=p.render("loading_more",{query:u}))&&(h.setAttribute("data-selectable",""),ae=h):u in de&&!re.querySelector(".no-results")&&(h=p.render("no_more_results",{query:u})),h&&(J(h,p.settings.optionClass),re.append(h))})),p.on("initialize",(()=>{pe=Object.keys(p.options),re=p.dropdown_content,p.settings.render=Object.assign({},{loading_more:()=>'<div class="loading-more-results">Loading more results ... </div>',no_more_results:()=>'<div class="no-more-results">No more results</div>'},p.settings.render),re.addEventListener("scroll",(()=>{p.settings.shouldLoadMore.call(p)&&c(p.lastValue)&&(ue||(ue=!0,p.load.call(p,p.lastValue)))}))}))})),ce}));var h=p;export{h as default};

